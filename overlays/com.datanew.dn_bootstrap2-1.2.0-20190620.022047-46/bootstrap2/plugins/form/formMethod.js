var formMthod={defaultVal:{},initForm:function(g,j){formMthod.defaultVal={};var D={};function k(J){var i=false;for(var K in D){if(D[K]==false&&K!=J){i=false;break}else{D[J]=true;i=true}}if(i&&j.onLoadedCallBack!=undefined){j.onLoadedCallBack()}}function f(i){if(i.url!=null||i.dataUrl!=null){D[i.name]=false;i.formInitCallBack=k}}function E(){var i=setTimeout(function(){g.find(".uploader").each(function(J){var K=$(this);if(!K.parent().hasClass(".dform-input")){K.parent().addClass("flex_val_1").parent().css({height:"auto"});if(!a()&&g.hasClass("form-inline")){K.parent().css({"margin-left":parseInt(j.labelwidth)})}}})},10)}function a(){var i=document.documentElement.style;return(("flexWrap" in i)||("WebkitFlexWrap" in i)||("msFlexWrap" in i))}var t={rownum:3,labelwidth:"50px",showtitle:"left",plugSize:"xs",labelAlign:"left"};j=$.extend({},t,j);g.addClass("form-inline clearfix");if(j.formVertical){g.addClass("form-vertical").removeClass("form-inline")}if(j.id!==undefined){g.attr("id",j.id)}var b="";if(j.plugSize==="xs"){g.addClass("form-xs");b="20px"}else{g.addClass("form-sm");b="30px"}g.html("");if(j.inputs){var F=Math.floor(12/j.rownum);var c={id:null,colspan:1,rowspan:1,defaultValue:"",disabled:false,setDisabled:false,setReadonly:false};for(var y=0;y<j.inputs.length;y++){var A=false;var p=j.inputs[y],u=p.id==null?"":' id="'+p.id+'" ',C=p.required?"requiredMark":"";p=$.extend({},c,p);formMthod.defaultVal[p.name]=p.defaultValue;var d=parseInt(b)*parseInt(p.rowspan)+(p.rowspan-1)*6,B=p.rowspan>1?"height:"+d+"px":"";var o="<div class='dform-input form-group dis_flex col-sm-"+F*p.colspan+"' style='"+B+"'>";if(p.type!=null&&j.showtitle=="left"){o+="<label class='control-label "+C+" label-align-"+j.labelAlign+"' for='' style='width:"+j.labelwidth+" ;line-height:"+b+"'>"+p.title+"</label>"}var h=p.proving==null?"":"proving='"+p.proving+"'";var v=p.dname==null?p.name:p.dname;if(p.type==null){o+="</div>";g.append(o)}else{if(p.type=="select"||p.type=="dselect"){o+="<select "+u+' class="form-control flex_val_1"  '+(p.disabled?"disabled":"")+(p.setDisabled?" disabled ":"")+(p.setReadonly?" readonly ":"")+h+' dname="'+v+'"  name="'+p.name+'"></select></div>';g.append(o);g.find(".form-group select:last").dselect(p);g.find(".form-group select:last").parent().addClass("flex_val_1")}else{if(p.type=="ddate"){o+="<input "+u+' type="text"  '+(p.disabled?"disabled":"")+(p.setDisabled?" disabled ":"")+(p.setReadonly?" readonly ":"")+" "+h+' dname="'+v+'" name="'+p.name+'" class="form-control bgwhite" /></div>';g.append(o);g.find(".form-group input:last").ddate(p);var I=g.width()/(j.rownum*p.colspan)-30;var G=I-parseInt(j.labelwidth);g.find(".form-group input:last").parent().addClass("flex_val_1").width(G)}else{if(p.type=="dsearchtree"||p.type=="searchTree"){o+="<input "+u+' type="text" '+(p.disabled?"disabled":"")+(p.setDisabled?" disabled ":"")+(p.setReadonly?" readonly ":"")+" "+h+' dname="'+v+'" name="'+p.name+'" class="form-control" style="width:100%;" /></div>';g.append(o);f(p);if(p.isGetText){g.find(".form-group input:last").data({isGetText:p.isGetText,getTextField:p.getTextField})}g.find(".form-group input:last").searchTree(p);g.find(".form-group input:last").parent().addClass("flex_val_1");g.find(".form-group:last-child .valueBox").data("async",($.plugAsyncConfig||false)&&!!p.url);var H=g.find(".form-group:last-child").find(".form-control");z(H,p)}else{if(p.type=="ddecimal"||p.type=="decimal"){o+="<input "+u+' type="number" '+(p.disabled?"disabled":"")+(p.setDisabled?" disabled ":"")+(p.setReadonly?" readonly ":"")+" "+h+' dname="'+v+'" name="'+p.name+'" class="form-control" style="width:100%;" /></div>';g.append(o);g.find(".form-group input:last").decimal(p);g.find(".form-group input:last").parent().addClass("flex_val_1");var H=g.find(".form-group:last-child").find(".form-control");z(H,p)}else{if(p.type=="html"){o+="<span class='ztreeBox_inp ztreeBox_down flex_val_1'>"+p.html+"</span>";o+="</div>";g.append(o)}else{if(p.type=="hidden"){o+="<input "+u+" "+h+' dname="'+v+'"  name="'+p.name+'" type="'+p.type+'" '+(p.disabled?"disabled":"")+(p.setDisabled?" disabled ":"")+(p.setReadonly?" readonly ":"")+' class="form-control flex_val_1" '+(p.placeholder==true?('  placeholder="请输入'+p.title):"")+'" value="'+p.defaultValue+'"></div>';g.append(o);g.find(".dform-input:last").hide();var H=g.find(".form-group:last-child").find(".form-control");z(H,p)}else{if(p.type=="comboTree"){o+="<input "+u+" "+h+' dname="'+v+'"  name="'+p.name+'" type="'+p.type+'" '+(p.disabled?"disabled":"")+(p.setDisabled?" disabled ":"")+(p.setReadonly?" readonly ":"")+' class="form-control " '+(p.placeholder==true?('  placeholder="请输入'+p.title):"")+"></div>";g.append(o);f(p);if(p.isGetText){g.find(".form-group input:last").data({isGetText:p.isGetText,getTextField:p.getTextField})}g.find(".form-group input:last").comboTree(p);g.find(".form-group input:last").parent().addClass("flex_val_1");g.find(".form-group:last-child .valueBox").data("async",($.plugAsyncConfig||false)&&!!p.url);var H=g.find(".form-group:last-child").find(".form-control");z(H,p)}else{if(p.type=="textBox"||p.type=="text"){var s=p.isPassword?"password":p.type;o+="<input "+u+" "+h+' dname="'+v+'"  name="'+p.name+'" type="'+s+'" '+(p.disabled?"disabled":"")+(p.setDisabled?" disabled ":"")+(p.setReadonly?" readonly ":"")+' class="form-control " style="width:100%;" ></div>';g.append(o);if(p.multiline){g.find(".form-group input:last").parent().height("auto")}g.find(".form-group input:last").textBox(p);g.find(".form-group input:last").parent().addClass("flex_val_1");var H=g.find(".form-group:last-child").find(".form-control");z(H,p)}else{if(p.type=="comboBox"){o+="<input "+u+"  "+h+' dname="'+v+'"  name="'+p.name+'" type="'+p.type+'" '+(p.disabled?"disabled":"")+(p.setDisabled?" disabled ":"")+(p.setReadonly?" readonly ":"")+' class="form-control " '+(p.placeholder==true?('  placeholder="请输入'+p.title):"")+"></div>";g.append(o);f(p);if(p.isGetText){g.find(".form-group input:last").data({isGetText:p.isGetText,getTextField:p.getTextField})}g.find(".form-group input:last").comboBox(p);g.find(".form-group input:last").parent().addClass("flex_val_1");var H=g.find(".form-group:last-child").find(".form-control");z(H,p)}else{if(p.type=="dateBox"){o+="<input "+u+"  "+h+' dname="'+v+'"  name="'+p.name+'" type="'+p.type+'" '+(p.disabled?"disabled":"")+(p.setDisabled?" disabled ":"")+(p.setReadonly?" readonly ":"")+' class="form-control"'+(p.placeholder==true?('  placeholder="请输入'+p.title):"")+"></div>";g.append(o);g.find(".form-group input:last").dateBox(p);g.find(".form-group input:last").parent().css({width:"100%"}).wrap('<div class="flex_val_1"></div>');var H=g.find(".form-group:last-child").find(".form-control");z(H,p)}else{if(p.type=="checkbox"){if(!p.options){return}$.each(p.options,function(J,K){o+='<lable style="margin-left: 8px;line-height: 30px;">'+K.lable+"</lable>";o+='<input  name="'+p.name+'" type="checkbox" value="'+K.value+'" style="vertical-align: middle;margin-top: 8px;">'});o+="</div>";g.append(o)}else{if(p.type=="webupload"){o+="</div>";var n=$("<div "+u+"></div>");g.append(o).find(".form-group:last").append(n);f(p);n.webupload(p);E(p)}else{if(p.type=="textEditor"){o+='<textarea class="textEditor" '+u+' name="'+p.name+'" dname="'+v+'" type="'+p.type+'" boxtype="'+p.type+'"></textarea></div>';g.append(o);g.find(".form-group .textEditor:last").textEditor(p);g.find(".form-group .textEditor:last").parent().addClass("flex_val_1").parent().css({height:"auto"})}else{if(p.type=="plainText"){o+='<div class="flex_val_1 text-'+(p.textAlign==undefined?"center":p.textAlign)+'" '+u+' style="min-height:'+b+";line-height:"+b+";"+(p.styles?p.styles:"")+'">'+(p.plainText==undefined?"":p.plainText)+"</div></div>";g.append(o);g.find(".form-group:last").find(".control-label").remove().end().find(".flex_val_1").css({marginLeft:0})}else{if(p.type=="title"){o+="";g.append(o)}else{if(p.type=="billPrint"){o+="<div "+u+' name="'+p.name+'" dname="'+p.name+'" type="'+p.type+'" boxtype="'+p.type+'" class="printWrap"></div>';g.append(o);var l=g.find(".form-group .printWrap:last");var r=p.addNodeOpts,w=$('<button type="button" class="btn btn-primary btn-xs" style="position:absolute; left:8px; top:40px;">新增节点</button>').insertAfter(l);l.billPrint(p);l.wrap('<div class="flex_val_1"></div>').parent().parent().css({height:"auto"});w.on("click",function(){l.billPrint("addTxtNode",r)})}else{if(p.type=="mediaBox"){o+="<a "+u+' type="'+p.type+'" class="mediaBox"></div>';g.append(o);p.width="100%";g.find(".form-group .mediaBox:last").mediaBox(p);g.find(".form-group .mediaBox:last").wrap('<div class="flex_val_1"></div>').parent().parent().css({height:"auto"})}else{if(p.type=="videoBox"){o+="<div "+u+' type="'+p.type+'" class="videoBox"></div>';g.append(o);p.width="100%";g.find(".form-group .videoBox:last").videoBox(p);g.find(".form-group .videoBox:last").wrap('<div class="flex_val_1"></div>').parent().parent().css({height:"auto"})}else{if(p.type=="iconBox"){o+="<button "+u+" "+h+' dname="'+v+'" name="'+p.name+'" type="'+p.type+'" '+(p.disabled?"disabled":"")+(p.setDisabled?" disabled ":"")+(p.setReadonly?" readonly ":"")+' class="iconBtn"></button>';g.append(o);g.find(".form-group .iconBtn:last").iconBox(p);g.find(".form-group .iconBtn:last").parent().addClass("flex_val_1")}else{if(p.type=="radioBox"){o+="<div "+u+" "+h+' dname="'+v+'" name="'+p.name+'" type="'+p.type+'" '+(p.disabled?"disabled":"")+(p.setDisabled?" disabled ":"")+(p.setReadonly?" readonly ":"")+' class="radioBox"></div>';g.append(o);g.find(".form-group .radioBox:last").radioBox(p);g.find(".form-group .radioBox:last").addClass("flex_val_1").parent().height("auto")}else{o+="<input "+u+"  "+h+' dname="'+v+'"  name="'+p.name+'" type="'+p.type+'" '+(p.disabled?"disabled":"")+(p.setDisabled?" disabled ":"")+(p.setReadonly?" readonly ":"")+' class="form-control flex_val_1" '+(p.placeholder==true?('  placeholder="请输入'+p.title):"")+'" value="'+p.defaultValue+'"></div>';g.append(o)}}}}}}}}}}}}}}}}}}}}}if(p.url||p.dataUrl){A=true}if(j.formVertical&&p.hoverTips){var m=g.find(".form-group:last"),e=m.find(".glyphicon-question-sign"),q=e.clone().appendTo(m.find(".control-label"));e.remove();q.tooltip()}}g.data("defaultVal",JSON.stringify(formMthod.defaultVal))}if(j.formtitle&&j.formtitle!=""){g.wrapInner("<fieldset class='form-fieldset'></fieldset>");g.find("fieldset").prepend("<legend class='form-legend'>"+j.formtitle+"</legend>")}if(j.onLoadedCallBack){}if(!a()&&g.hasClass("form-inline")){var x=parseInt(j.labelwidth);g.find(".form-group").each(function(L){var K=$(this).children(".control-label").next(),M=$(this).find("[name][boxType]"),J=M.attr("boxType");if(J!=="webupload"&&M.length>0){K.css({"margin-left":x})}})}function z(i,K){var J=i.siblings(".valueBox").attr("boxtype");if(K.setDisabled){i[J]("setDisabled",true)}if(K.setReadonly){i.removeClass("bgwhite").addClass("readonly");i[J]("disable")}}},upload:function(a){$(this).ajaxSubmit(a)},submit:function(d){var a=formMthod.validate.apply(this);if(!a){return}var c=formMthod.getData.apply(this);if(d.data){var b=d.data;d.data=$.extend({},b,c)}else{d.data=c}$.dajax(d)},getInputObj:function(c,d){var e="name";if(d!=null){e=d}var b,a=c.attr("boxType");if(c.attr(e)!==undefined&&c.attr("boxType")!==undefined){if(a==="webupload"||a==="radioBox"){b=c.parent()}else{if(a==="textEditor"||a==="billPrint"){b=c}else{if(a==="iconBox"){b=c.parent().find(".iconBtn")}else{b=c.parent().find(".form-control")}}}}return b},getData:function(){var a=this.serializeArray(),f={};$.each(a,function(){if(f[this.name]!=undefined){if(!f[this.name].push){f[this.name]=[f[this.name]]}f[this.name].push(this.value||"")}else{f[this.name]=this.value||""}});var b=$(this).find("[boxType='textEditor']");if(b.length>0&&!b.prop("disabled")){f[b.attr("name")]=d(b.textEditor("getValue"))}var e=$(this).find("[boxType='billPrint']");if(e.length>0&&!e.prop("disabled")){f[e.attr("name")]=d(e.billPrint("getValue"))}var c=$(this).find("[boxType='searchTree'], [boxType='comboTree'], [boxType='comboBox']");c.each(function(){var i=$(this).attr("boxType"),g=$(this).attr("name"),j=$(this).siblings(".form-control");if(j.data("isGetText")){var h=j.data("getTextField")?j.data("getTextField"):g+"_text",k=j[i]("getText");f[h]=k}});function d(g){g=g.replace(/&/g,"&amp;");g=g.replace(/</g,"&lt;");g=g.replace(/>/g,"&gt;");g=g.replace(/'/g,"&acute;");g=g.replace(/"/g,"&quot;");g=g.replace(/\|/g,"&brvbar;");g=g.replace(/\n/g,"");g=g.replace(/\t/g,"");return g}return f},getValueByName:function(a){var b=this.dform("getData");for(var c in b){if(c===a){return b[c]}}},setValueByName:function(d,e){if($("[name="+d+"]",$(this)).hasClass("form-control")){$("[name="+d+"]",$(this)).val(e);return false}var c=$("[name="+d+"][boxType]",$(this)),b=c.attr("boxType"),a=formMthod.getInputObj(c);if(c.data("async")==false&&c.data("async")!==undefined){if(a){a[b]("setValue",e)}}else{if(a&&b!=="searchTree"&&b!=="dsearchtree"&&b!=="comboTree"){a[b]("setValue",e)}else{c.val(e);c.change()}}},executeByName:function(e,g,f){var d=$("[name="+e+"][boxType]",$(this)),c=d.attr("boxType"),b=formMthod.getInputObj(d);if(b){var a=b[c](g,f);if(a!==undefined){return a}}},load:function(c,a){var b="name";if(a!=null){b=a}$(this).find("["+b+"]").each(function(){var f=$(this),g=f.attr(b),e=f.attr("boxType"),d;if($(this).data("async")==false&&$(this).data("async")!==undefined){d=formMthod.getInputObj(f,a);if(d){d[e]("setValue",c[g])}}if(c[g]!=null){f.val(c[g])}else{f.val("")}});formMthod.executeInputMethod.apply(this,["setValue",c,a])},validate:function(){var a=true;$("[proving]",this).each(function(){if(!$.dvalidate($(this),true)){a=false;$(this).change()}});$("[name][boxType]",$(this)).each(function(){var d=$(this),c=d.attr("boxType"),b=formMthod.getInputObj(d);if(b&&!b[c]("validate")){a=false;return false}});return a},clear:function(){$(this).clearForm(true);formMthod.executeInputMethod.apply(this,["clear"]);$(this).find(".has-error").each(function(a,b){b.classList.remove("has-error")})},initDefault:function(){$(this).dform("load",JSON.parse($(this).data("defaultVal")))},readonly:function(){$(":input",this).each(function(){$(this).attr("readonly",true)});formMthod.executeInputMethod.apply(this,["readonly"])},disabled:function(){$(":input",this).each(function(){$(this).attr("readonly",true)});$("select",this).each(function(){$(this).attr("disabled",true)});formMthod.executeInputMethod.apply(this,["disable"])},enable:function(){$(":input",this).each(function(){var a=$(this).siblings(".valueBox").attr("boxtype");if(a!="dateBox"&&a!="searchTree"&&a!="comboBox"&&a!="comboTree"){$(this).removeAttr("readonly")}});$("select",this).each(function(){$(this).attr("disabled",false)});formMthod.executeInputMethod.apply(this,["enable"])},setDisabled:function(a){if(a==true){$(".dform-input > input:hidden").attr({readonly:true,disabled:true});$("textarea[boxtype]",this).attr({readonly:true,disabled:true});formMthod.disabled()}else{$(".dform-input > input:hidden").removeAttr("readonly").removeAttr("disabled");$("textarea[boxtype]",this).removeAttr("readonly").removeAttr("disabled");formMthod.enable()}formMthod.executeInputMethod.apply(this,["setDisabled",a])},setReadonly:function(a){if(a==true){formMthod.disabled()}else{formMthod.enable()}formMthod.executeInputMethod.apply(this,["setReadonly",a])},destroy:function(){$(this).find("[name][boxType]").each(function(){var c=$(this),b=c.attr("boxType"),a=formMthod.getInputObj(c);if(a){a[b]("destroy")}c.remove()})},executeInputMethod:function(d,c,a){var b="name";if(a!=null){b=a}$("["+b+"][boxType]",$(this)).each(function(){var g=$(this),f=g.attr("boxType"),e=formMthod.getInputObj(g,a);if(e){e[f](d,d=="setValue"?c[$(this).attr(b)]:c)}})}};