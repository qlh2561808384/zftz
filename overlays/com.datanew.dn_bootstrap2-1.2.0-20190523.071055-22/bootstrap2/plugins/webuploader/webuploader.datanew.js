var WebUpload=function(b,a){this.$wrap=b;this.$placeHolder;this.$queue;this.$statusBar;this.options=a;this.fileCount=0;this.fileSize=0;this.state="pedding";this.percentages={};this.$valueBox;this.$uploader;this.currentView;this.singleFilesArr=[];this.loadedFiles=[];this.initWebUpload()};WebUpload.ratio=window.devicePixelRatio||1;WebUpload.DEFAULTS={isDel:true,previewTarget:"self",defaultView:"bigPic",dataUrl:"",delUrl:"",downloadUrl:"",fileIdKey:"fileId",listHeight:null,hoverTips:false,singleMode:false,thumbnailWidth:70*parseInt(WebUpload.ratio),thumbnailHeight:70*parseInt(WebUpload.ratio),paste:document.body,swf:$.getRootPath()+"/"+__bootstrapVersionPath+"/plugins/webuploader/Uploader.swf",chunked:false,chunkSize:512*1024,server:"",disableGlobalDnd:true,onLoaded:function(a){}};WebUpload.prototype.initWebUpload=function(){var e=this.options,j=this,c="";if(e.thumbnailWidth<=90){c="uploader_sm"}this.$wrap.addClass("uploader").addClass(c).append('<div class="queueList"><div class="dndArea placeholder"><div class="filePicker"></div><p>或将文件拖到这里</p></div></div><div class="statusBar" style="display:none;"><div class="progress"><span class="text">0%</span><span class="percentage"></span></div><div class="info"></div><div class="btns clearfix"><div class="filePicker2"></div><div class="uploadBtn">开始上传</div></div></div>').wrap('<div class="webupload ztreeBox_inp ztreeBox_down"></div>');var o=this.$wrap,k=e.name==undefined?"webupload":e.name,t=o.find(".queueList");this.$valueBox=$('<input type="hidden" class="valueBox" boxType="webupload" dname="'+k+'" name="'+k+'" />').appendTo(o);this.$placeHolder=o.find(".placeholder");this.$queue=$('<ul class="filelist"></ul>').appendTo(t);this.$statusBar=o.find(".statusBar");var d=this.$valueBox,g=this.$queue,f=this.$placeHolder,u=this.$statusBar,m=o.find(".filePicker"),i=o.find(".filePicker2"),b=u.find(".info"),n=u.find(".progress").hide(),a=o.find(".uploadBtn"),v=this.fileCount,l=this.fileSize,q=(function(){var y=new Image();var x=true;y.onload=y.onerror=function(){if(this.width!=1||this.height!=1){x=false}};y.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";return x})(),w=(function(){var x;try{x=navigator.plugins["Shockwave Flash"];x=x.description}catch(y){try{x=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(z){x="0.0"}}x=x.match(/\d+/g);return parseFloat(x[0]+"."+x[1],10)})(),s=(function(){var x=document.createElement("p").style,y="transition" in x||"WebkitTransition" in x||"MozTransition" in x||"msTransition" in x||"OTransition" in x;x=null;return y})(),p;if(!WebUploader.Uploader.support("flash")&&WebUploader.browser.ie){if(w){(function(x){window.expressinstallcallback=function(A){switch(A){case"Download.Cancelled":$.dalert({text:"您取消了更新！",icon:7});break;case"Download.Failed":$.dalert({text:"安装失败",icon:2});break;default:$.dalert({text:"安装已成功，请刷新！",icon:1});break}delete window.expressinstallcallback};var z="./expressInstall.swf";var y='<object type="application/x-shockwave-flash" data="'+z+'" ';if(WebUploader.browser.ie){y+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '}y+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+z+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /></object>';x.html(y)})(o)}else{o.html('<a href="http://www.adobe.com/go/getflashplayer" target="_blank" border="0"><img alt="get flash player" src="http://www.adobe.com/macromedia/style_guide/images/160x41_Get_Flash_Player.jpg" /></a>')}return}else{if(!WebUploader.Uploader.support()){$.dalert({text:"Web Uploader 不支持您的浏览器！",icon:2});return}}if(e.singleMode){j.$wrap.addClass("uploader_single");e.defaultView="singleFile";e.fileNumLimit=2}j.defaultDelUrl=$.getRootPath()+"/"+__bootstrapVersionPath+"/plugins/webuploader/delFile.json";if(j.options.auto){a.hide()}e.pick={id:m,innerHTML:"点击选择文件"};e.dnd=t;e=$.extend(true,{},WebUpload.DEFAULTS,e);this.$uploader=WebUploader.create(e);if(e.formInitCallBack!=null){e.formInitCallBack(e.name)}j.currentView=e.defaultView;p=this.$uploader;if(e.setDisabled){this.setDisabled(true)}if(e.setReadonly){this.readonly()}j.showToggleBtn(e.singleMode?false:true);j.setView(e.defaultView);p.on("dndAccept",function(x){if(e.dndAccept===undefined){e.dndAccept=function(y){}}e.dndAccept.call(this,x)});p.addButton({id:i,label:e.singleMode?"更改":"继续添加"});if(e.hoverTips&&e.hoverTips!==""){var h=$('<i class="glyphicon glyphicon-question-sign" data-toggle="tooltip" data-placement="top" title="'+e.hoverTips+'"></i>').insertBefore(this.$wrap);h.tooltip()}p.on("uploadAccept",function(y,x){if(e.uploadAccept===undefined){e.uploadAccept=function(B,A){}}j.addValue(x[e.fileIdKey]);y.file.fileId=x[e.fileIdKey];var z=$("#"+y.file.id).find(".download");if(z.length>0){z.find("a").attr({href:e.downloadUrl+"?id="+y.file.fileId})}e.uploadAccept.call(this,y,x)});function r(B){var D=j.appendFiles("newAdd",B),A=D.find("p.progress span"),C=D.find("p.imgWrap"),z=D.find(".file-panel"),y=$('<p class="error"></p>');var x=function(E){switch(E){case"exceed_size":text="文件大小超出";break;case"interrupt":text="上传暂停";break;default:text="上传失败，请重试";break}y.text(text).appendTo(D)};if(B.getStatus()==="invalid"){x(B.statusText)}else{C.text("预览中");p.makeThumb(B,function(I,J){var F;if(I){var H=B.name,G=H.lastIndexOf(".");if(G!=-1){H=H.substring(G+1,H.length);var E=j.checkFileIcon(H);F=$('<span class="fa-file-wrap"><i class="fa '+E+'"></i></span>');C.empty().append(F);if(j.currentView==="bigPic"){C.css({width:e.thumbnailWidth,height:e.thumbnailHeight+25});F.css({fontSize:e.thumbnailHeight/2,lineHeight:e.thumbnailHeight+"px"})}}else{C.text("不能预览")}return}if(q){F=$('<img src="'+J+'">');C.empty().append(F);if(j.currentView==="bigPic"){C.width(e.thumbnailWidth).height(e.thumbnailHeight)}B.base64Url=J}else{$.ajax("../../server/preview.php",{method:"POST",data:J,dataType:"json"}).done(function(K){if(K.result){F=$('<img src="'+K.result+'">');C.empty().append(F)}else{C.text("预览出错")}})}},"auto","auto");j.percentages[B.id]=[parseInt(B.size),0];B.rotation=0}B.on("statuschange",function(F,E){if(E==="progress"){A.hide().width(0)}else{if(E==="queued"){if(!j.options.isDel&&!j.options.downloadUrl){D.off("mouseenter mouseleave");z.remove()}else{if(j.options.isDel&&!j.options.downloadUrl){z.find(".download").remove()}else{if(j.options.downloadUrl&&!j.options.isDel){z.find(".cancel").remove()}}}}}if(F==="error"||F==="invalid"){x(B.statusText);j.percentages[B.id][1]=1}else{if(F==="interrupt"){x("interrupt")}else{if(F==="queued"){j.percentages[B.id][1]=0}else{if(F==="progress"){y.remove();A.css("display","block")}else{if(F==="complete"){D.append('<span class="success"></span>')}}}}}D.removeClass("state-"+E).addClass("state-"+F)})}p.onUploadProgress=function(z,x){var A=$("#"+z.id),y=A.find(".progress span");y.css("width",x*100+"%");j.percentages[z.id][1]=x;j.updateTotalProgress()};p.onFileQueued=function(x){if(e.singleMode){j.$queue.empty();j.singleFilesArr.push(x);if(j.singleFilesArr.length>2){j.singleFilesArr.splice(0,1)}if(j.fileCount===1){var z=j.$queue.find("li").eq(0),y=j.singleFilesArr[0];if(z.hasClass("state-complete")){$.dajax({url:e.delUrl===""?j.defaultDelUrl:e.delUrl+"?id="+y.fileId,success:function(A){j.removeViewFile(y);j.$valueBox.val("");j.$uploader.removeFile(y)}})}else{j.$uploader.removeFile(y);j.$valueBox.val("")}}}j.fileCount++;j.fileSize+=parseInt(x.size);if(j.fileCount===1){f.addClass("element-invisible");u.show()}r(x);j.setState("ready");j.updateTotalProgress()};p.onFileDequeued=function(x){j.fileCount--;j.fileSize-=parseInt(x.size);if(!j.fileCount){j.setState("pedding")}j.removeViewFile(x);j.updateTotalProgress();if(j.fileCount==0){j.$placeHolder.show().removeClass("element-invisible").find(":file").parent().css({width:"100%",height:"100%"});j.$statusBar.hide()}};p.on("all",function(y){var x;switch(y){case"uploadFinished":j.setState("confirm");break;case"startUpload":j.setState("uploading");break;case"stopUpload":j.setState("paused");break}});p.onError=function(y){var x="";if(y==="F_DUPLICATE"){x="文件队列中已有该文件"}else{if(y==="Q_TYPE_DENIED"){x="文件类型不匹配"}else{if(y==="Q_EXCEED_NUM_LIMIT"){x="文件总数量不能超出"+e.fileNumLimit+"个"}else{if(y==="Q_EXCEED_SIZE_LIMIT"){x="文件总大小不能超出"+Math.floor(e.fileSizeLimit/1024/1024)+"MB"}else{if(y==="F_EXCEED_SIZE"){x="单个文件大小不能超出"+Math.floor(e.fileSingleSizeLimit/1024/1024)+"MB"}}}}}$.dalert({text:x,icon:2})};a.on("click",function(){if($(this).hasClass("disabled")){return false}if(j.state==="ready"){p.upload()}else{if(j.state==="paused"){p.upload()}else{if(j.state==="uploading"){p.stop()}}}});b.on("click",".retry",function(){p.retry()});b.on("click",".ignore",function(){if(e.onIgnore){e.onIgnore(this,p)}});a.addClass("state-"+j.state);j.updateTotalProgress()};WebUpload.prototype.setState=function(c){var h=this,e=h.$statusBar,i=e.find(".uploadBtn"),j=e.find(".progress"),k=h.$placeHolder,g=h.$queue,b=h.$uploader,a=h.$wrap.find(".filePicker2");var d,f;if(c===h.state){return}if(h.options.auto){i.hide()}i.removeClass("state-"+h.state);i.addClass("state-"+c);h.state=c;switch(h.state){case"pedding":k.removeClass("element-invisible");g.empty();e.addClass("element-invisible");b.refresh();break;case"ready":k.addClass("element-invisible");a.removeClass("element-invisible");g.show();e.removeClass("element-invisible");b.refresh();break;case"uploading":a.addClass("element-invisible");j.show().css({display:"inline-block"});i.text("暂停上传");break;case"paused":j.show().css({display:"inline-block"});i.text("继续上传");break;case"confirm":j.hide();a.removeClass("element-invisible");i.text("开始上传");f=b.getStats();if(f.successNum&&!f.uploadFailNum){h.setState("finish");return}break;case"finish":f=b.getStats();if(f.successNum){if(!h.options.auto){$.dalert({text:"上传成功",icon:1})}}else{h.state="done";location.reload()}break}h.updateStatus()};WebUpload.prototype.removeViewFile=function(b){var f=$("#"+b.id),d=this,a=d.options,e=d.$queue;delete this.percentages[b.id];this.updateTotalProgress();f.off().find(".file-panel").off().end().remove();if(a.listHeight!=null){var c=e[0].offsetWidth-e[0].clientWidth;d.$queue_listHd.css({"padding-right":c})}};WebUpload.prototype.updateTotalProgress=function(){var a=0,d=0,b=this.$statusBar.find(".progress").children(),c;$.each(this.percentages,function(f,e){d+=e[0];a+=e[0]*e[1]});c=d?a/d:0;b.eq(0).text(Math.round(c*100)+"%");b.eq(1).css("width",Math.round(c*100)+"%");this.updateStatus()};WebUpload.prototype.updateStatus=function(){var c=this,d="",b,e=c.fileCount,a=c.fileSize;if(c.state==="ready"){d="选中"+e+"个文件，共"+WebUploader.formatSize(a)+"。"}else{if(c.state==="confirm"){b=c.$uploader.getStats();if(b.uploadFailNum){d="已成功上传"+b.successNum+"个文件，"+b.uploadFailNum+'个文件上传失败，<a class="retry" href="#">重新上传</a>失败文件或<a class="ignore" href="#">忽略</a>'}}else{b=c.$uploader.getStats();d="共"+e+"个文件（"+WebUploader.formatSize(a)+"），已上传"+c.$wrap.find(".state-complete").length+"个文件";if(b.uploadFailNum){d+="，失败"+b.uploadFailNum+"个文件"}}}this.$wrap.find(".info").html(d)};WebUpload.prototype.showToggleBtn=function(b){var d=this,i=d.options,c=this.$queue,a=this.$wrap.find(".filePicker2");if(b===undefined||b===true){if(d.$wrap.find(".switchViewBtn").length===0){var f=$('<div class="switchViewBtn"><i class="fa"></i></div>').prependTo(a.parent()),h=f.find(".fa"),g="fa-th-large",e="fa-list-ul";if(i.defaultView==="bigPic"){h.addClass(g)}else{h.addClass(e)}f.on("click",function(){if(h.hasClass(g)){d.setView("bigPic")}else{d.setView("detailList")}});d.$queue_listHd=$('<ul class="view_detailList list-unstyled"><li class="detailList_hd"><p class="title">文件名称</p><p class="uploadDate">上传日期</p><p class="type">文件类型</p><p class="size">文件大小</p></li></ul>').hide();c.before(d.$queue_listHd)}}else{if(b===false){this.$wrap.find(".switchViewBtn").remove();this.$wrap.find(".detailList_hd").remove()}}};WebUpload.prototype.deleteFile=function(c){var d=this,b=this.options,e=$("#"+c.id),a=e.index();$.dopen({type:0,title:"删除",content:"确定删除？",btn:["确定","取消"],btn1:function(f){if(d.fileCount===1&&d.currentView==="detailList"){d.$queue_listHd.hide()}if(e.hasClass("state-complete")){$.dajax({url:b.delUrl===""?d.defaultDelUrl:b.delUrl+"?id="+c.fileId,success:function(h){d.removeViewFile(c);var g=d.$valueBox.val().split(",");g.splice(a,1);d.$valueBox.val(g.join(","));d.$uploader.removeFile(c);$.each(d.loadedFiles,function(j){if(this.fileId==c.fileId){d.loadedFiles.splice(j,1);return false}})}})}else{d.$uploader.removeFile(c)}layer.close(f)}})};WebUpload.prototype.previewFile=function(s){var h=this,c=this.options,t=(c.previewTarget==="parent"),b=t?$(window.parent.document).find("body"):$("body"),k=t?$(window.parent):$(window),m=t?parent.layer:layer,j,f="",n="",p="",e="carouselPic";if(s.ext==="pdf"){n="";f="";p='<a class="picBox-pdf"></a>'}else{n='<span class="toggle_btn glyphicon glyphicon-menu-left"></span><span class="toggle_btn glyphicon glyphicon-menu-right"></span>';f='<a href="javascript:void(0);" class="btn-rotate"><i class="glyphicon glyphicon-repeat"></i></a>';p='<img src="'+s.base64Url+'" class="picBox-img" />'}if(b.find(".uploader_previewArea").length===0){j=$('<div class="uploader_previewArea" onselectstart="return false" unselectable="on"><div class="preview-mask"></div><div class="preview-picBox">'+p+'</div><div class="preview-btns">'+f+'<a href="javascript:void(0);" class="btn-close"><i class="glyphicon glyphicon-remove"></i></a></div>'+n+"</div>");b.css("overflow","hidden").append(j)}if(s.ext==="pdf"){var d=j.find(".picBox-pdf");$.dajax({url:c.downloadUrl+"?id="+s.fileId,success:function(u){d.mediaBox({height:$(window).height(),src:""})}})}else{var i=j.find(".picBox-img");l(i);i.bind("mousewheel",function(w){var v=w||window.event,u=v.originalEvent,y=u.wheelDelta||u.detail,x=(y<0);g(i,x);window.event.returnValue=false;return false});var q=j.find(".glyphicon-menu-left"),o=j.find(".glyphicon-menu-right"),r=h.getAllImages(),a;q.on("click",function(){a=r.indexOf(i.attr("src"));if(a===0){m.msg("已经是第一张啦",{zIndex:999999999,time:1000})}else{if(a>0){i.attr("src",r[a-1]);l(i)}}});o.on("click",function(){a=r.indexOf(i.attr("src"));if(a===r.length-1){m.msg("已经是最后一张啦",{zIndex:999999999,time:1000})}else{if(a<r.length-1){i.attr("src",r[a+1]);l(i)}}})}j.find(".btn-close").on("click",function(){b.css("overflow","auto");j.remove()});j.find(".btn-rotate").on("click",function(){var u=i.css("transform").split("(")[1].split(")")[0].split(","),v=Math.round(Math.atan2(u[1],u[0])*(180/Math.PI));i.css({transform:"rotate("+(v+90)+"deg)"})});function l(u){u.width("auto").height("auto").css({bottom:"0"});if(u.width()>=k.width()){u.css({width:"100%",height:"auto"})}if(u.height()>=k.height()){u.css({width:"auto",height:"100%"})}}function g(w,v){var u;if(!v){u=w.height()*1.1;if(u>=k.height()){w.css({bottom:"auto"})}}else{u=w.height()*0.9;if(u<k.height()){w.css({bottom:"0"})}}w.height(u).width("auto")}};WebUpload.prototype.loadData=function(a){if(a===undefined||a===""){return}var c=this,d=this.$queue,b=this.$wrap.find(".info");this.$placeHolder.hide();this.$statusBar.show().find(":file").parent().css({width:"100%",height:"100%"});$.dajax({url:a,success:function(g){var h=0,e=0,f="";d.empty();if(c.options.singleMode){if(g.length>0){g=g.splice(0,1)}c.singleFilesArr.push(c.getWuFile(g[0]))}$.each(g,function(k){f+=g[k].fileId+",";var j=c.getWuFile(g[k]);if(g[k].base64Url){j.base64Url=g[k].base64Url}j.fileId=g[k].fileId;h++;e+=parseInt(j.size);c.appendFiles("loadData",j)});c.$placeHolder.addClass("element-invisible");c.setView(c.currentView);b.html("共"+h+"个文件（"+WebUploader.formatSize(e)+"）");c.fileCount=d.find("li").length;c.fileSize=e;c.$valueBox.val("");c.addValue(f.substring(0,f.length-1));if(!!c.$valueBox.prop("disabled")){c.setDisabled(true)}}})};WebUpload.prototype.appendFiles=function(d,h){var m,l=this,p=l.options,i=this.$queue,f,a;l.setState("ready");if(d==="newAdd"){if(l.currentView==="detailList"){l.$queue_listHd.show()}f=(h.type.indexOf("image")>-1);a=false;if(p.singleMode){m=$('<li id="'+h.id+'"><p class="title">'+h.name+"</p></li>")}else{m=$('<li id="'+h.id+'"><p class="imgWrap"></p><p class="title">'+h.name+'</p><p class="uploadDate">'+l.formatDate(h.uploadDate)+'</p><p class="type">'+h.type+'</p><p class="size">'+WebUploader.formatSize(h.size)+'</p><p class="progress"><span></span></p></li>')}}else{if(d==="loadData"){var c=h.name,k=c.lastIndexOf("."),e=c.substring(k+1,c.length),n=l.checkFileIcon(e);f=!!h.base64Url;a=(h.ext==="pdf");if(p.singleMode){m=$('<li id="'+h.id+'" class="state-complete"><p class="title">'+h.name+'</p><span class="success"></span></li>')}else{var o=h.base64Url?'<img src="'+h.base64Url+'" />':'<i class="fa '+n+'"></i>';m=$('<li id="'+h.id+'" class="state-complete"><p class="imgWrap"><span class="fa-file-wrap">'+o+'</span></p><p class="title">'+h.name+'</p><p class="uploadDate">'+l.formatDate(h.uploadDate)+'</p><p class="type">'+h.type+'</p><p class="size">'+WebUploader.formatSize(h.size)+'</p><p class="progress"><span></span></p><span class="success"></span></li>')}l.loadedFiles.push(h)}}var b=l.setPanelBtns(d,h),g=$(b).appendTo(m.addClass("clearfix"));if(g.children().length>0){g.on("click","span",function(){var q=$(this).attr("class");if(q.indexOf("cancel")!==-1){if($(this).hasClass("delDisabled")){$.dalert({text:"禁用/只读状态下不可删除",icon:2})}else{l.deleteFile(h)}}else{if(q.indexOf("preview")!==-1){l.previewFile(h)}}})}m.appendTo(i);l.setBtnView();if(f){m.on("click",".imgWrap, .success",function(){l.previewFile(h)})}if(p.listHeight!=null){i.height(parseInt(p.listHeight)).css({overflow:"auto"});var j=i[0].offsetWidth-i[0].clientWidth;l.$queue_listHd.css({"padding-right":j})}return m};WebUpload.prototype.setPanelBtns=function(f,c){var b='<div class="file-panel">',a=this.options,d=a.downloadUrl+"?id="+c.fileId,g,e;if(f==="newAdd"){b+='<span class="cancel"><i class="fa fa-trash-o"></i></span>';g=(c.type.indexOf("image")>-1);e=false}else{if(f==="loadData"){if(this.options.isDel){b+='<span class="cancel"><i class="fa fa-trash-o"></i></span>'}g=!!c.base64Url;e=(c.ext==="pdf")}}if(this.options.downloadUrl){b+='<span class="download"><a href="'+d+'" target="_blank"><i class="fa fa-download"></i></a></span>'}if(g){b+='<span class="preview"><i class="fa fa-eye"></i></span>'}b+="</div>";return b};WebUpload.prototype.addValue=function(c){var b=this.getValue(),a=b===""?"":",";this.$valueBox.val(b+a+c)};WebUpload.prototype.setValue=function(c){var b=this.options;this.$queue.empty();this.$valueBox.val("");if(c==null||c===undefined){return}if(b.singleMode){c=c.substring(0,c.indexOf(","))}var a=b.dataUrl.indexOf("?")>-1?b.dataUrl+"&ids="+c:b.dataUrl+"?ids="+c;this.loadData(a)};WebUpload.prototype.getValue=function(){if(!!this.$valueBox.attr("disabled")){return false}return this.$valueBox.val()};WebUpload.prototype.getData=function(){var a=this.$uploader.getFiles("complete");return this.loadedFiles.concat(a)};WebUpload.prototype.getAllImages=function(){var a=this,c=a.$queue,b=[];c.find("li").each(function(d){var e=$(this);if(e.find(".file-panel .preview").length>0&&e.find(".type").text().indexOf("image")>-1){b.push(e.find(".imgWrap img").attr("src"))}});return b};WebUpload.prototype.readonly=function(){var a=this;var b=setInterval(function(){if(a.$wrap.find(":file").length>0){a.$uploader.disable();a.$wrap.addClass("disabledUpload").find(".uploadBtn").addClass("disabled");a.$wrap.find(".cancel").addClass("delDisabled");a.setBtnView();clearInterval(b)}},10)};WebUpload.prototype.disable=function(){var a=this;var b=setInterval(function(){if(a.$wrap.find(":file").length>0){a.$uploader.disable();a.$wrap.addClass("disabledUpload").find(".uploadBtn").addClass("disabled");a.$wrap.find(".cancel").addClass("delDisabled");a.setBtnView();clearInterval(b)}},10)};WebUpload.prototype.enable=function(){this.$uploader.enable();this.$wrap.removeClass("disabledUpload").find(".uploadBtn").removeClass("disabled");this.$wrap.find(".cancel").removeClass("delDisabled");this.setBtnView()};WebUpload.prototype.setDisabled=function(a){if(a==true){this.disable();this.$valueBox.attr("disabled","disabled")}else{this.enable();this.$valueBox.removeAttr("disabled")}};WebUpload.prototype.setReadonly=function(a){if(a==true){this.disable()}else{this.enable()}};WebUpload.prototype.destroy=function(){this.fileCount=0;this.fileSize=0;this.$uploader.destroy();this.$wrap.remove()};WebUpload.prototype.clear=function(){var a=this.$uploader,b=this.$uploader.getFiles();$.each(b,function(c){a.removeFile(b[c])});this.setState("pedding");this.$valueBox.val("");this.$queue.empty();if(this.$queue_listHd!==undefined){this.$queue_listHd.hide()}this.$placeHolder.show().removeClass("element-invisible").find(":file").parent().css({width:"100%",height:"100%"});this.$statusBar.hide();this.fileCount=0;this.fileSize=0};WebUpload.prototype.validate=function(){var a=true,f=$.trim(this.$valueBox.val()),e=this,b=this.options;var d=this.$queue.find("li.state-complete").length,c=this.$queue.find("li").length;if(d<c){layer.tips("还有文件未上传成功",this.$wrap,{tipsMore:true,time:2000});this.$wrap.addClass("has-error");return false}if(b.required&&f==""){layer.tips("该选项为必填",this.$wrap,{tipsMore:true,time:2000});this.$wrap.addClass("has-error");return false}if(a){this.$wrap.removeClass("has-error")}else{this.$wrap.addClass("has-error")}return a};WebUpload.prototype.getWuFile=function(a){return new WebUploader.File(new WebUploader.Lib.File(WebUploader.guid("rt_"),a))};WebUpload.prototype.formatDate=function(c){if(typeof c==="number"){c=new Date(c)}if(typeof c==="object"){var e=c.getFullYear(),f=c.getMonth()+1<10?"0"+(c.getMonth()+1):(c.getMonth()+1),b=c.getDate()<10?"0"+c.getDate():c.getDate(),a=c.getHours()<10?"0"+c.getHours():c.getHours(),d=c.getMinutes()<10?"0"+c.getMinutes():c.getMinutes();return e+"-"+f+"-"+b+" "+a+":"+d}else{if(typeof c==="string"){return c}}};WebUpload.prototype.setView=function(g){var c=this,i=this.options,b=this.$queue,a=this.$statusBar;b.addClass("view_"+g);this.currentView=g;var e=a.find(".switchViewBtn"),h=e.find(".fa"),f="fa-th-large",d="fa-list-ul";if(g==="bigPic"){h.removeClass(f).addClass(d);b.removeClass("view_detailList").addClass("view_bigPic");c.$queue_listHd.hide();b.find(".imgWrap").css({width:i.thumbnailWidth,height:i.thumbnailHeight+25});b.find(".fa-file-wrap").css({fontSize:i.thumbnailHeight/2,lineHeight:i.thumbnailHeight+"px"})}else{if(g==="detailList"){h.removeClass(d).addClass(f);b.removeClass("view_bigPic").addClass("view_detailList");if(b.children().length>0){c.$queue_listHd.show()}b.find(".imgWrap").removeAttr("style");b.find(".fa-file-wrap").removeAttr("style")}else{if(g==="singleFile"){c.$wrap.addClass("clearfix")}}}c.setBtnView()};WebUpload.prototype.setBtnView=function(){var b=this,c=b.$queue,a=c.find("li");a.each(function(e){var f=$(this),d=f.find(".file-panel");if(b.currentView==="bigPic"){d.height(0);f.on("mouseenter",function(){d.stop().animate({height:30})}).on("mouseleave",function(){d.stop().animate({height:0})});d.appendTo(f)}else{d.height(20);f.off("mouseenter").off("mouseleave");d.appendTo(f.find(".title"))}})};WebUpload.prototype.checkFileIcon=function(b){var a="";switch(b){case"gif":case"jpg":case"jpeg":case"bmp":case"png":a="fa-file-image-o";break;case"xlsx":case"xls":a="fa-file-excel-o";break;case"pdf":a="fa-file-pdf-o";break;case"ppt":a="fa-file-powerpoint-o";break;case"txt":a="fa-file-text-o";break;case"doc":case"docx":a="fa-file-word-o";break;case"zip":case"rar":a="fa-file-zip-o";break;default:a="fa-file-o"}return a};