var IconBox=function(b,a){this.options=a;this.$btn=b;this.$openWrap;this.$outerBox;this.$valueBox;this.datas;this.initIconBox()};IconBox.prototype.initIconBox=function(){var c=this,a=c.options,b=this.$btn;b.wrap('<div class="iconBox ztreeBox_inp ztreeBox_down"></div>');c.$outerBox=b.parent();b.attr({type:"button"}).addClass("btn btn-xs btn-default").text("点击选择图标").after("<input type='hidden' class='valueBox'/>");c.$valueBox=b.next(".valueBox").attr({boxtype:"iconBox"});c.$showIcon=$('<span class="showIcon"></span>').insertAfter(c.$btn);if(a.url!==""){$.dajax({url:a.url,data:a.queryParam,success:function(d){c.datas=d}})}else{if(a.localdata!==undefined){c.datas=a.localdata}}b.on("click",function(){c.openIconWrap()});if(a.defaultValue!==""){c.setValue(a.defaultValue)}if(this.$btn.attr("dname")!=undefined){this.$valueBox.attr("dname",this.$btn.attr("dname"));this.$btn.removeAttr("dname")}if(a.hasOwnProperty("name")){this.$valueBox.attr("name",a.name)}if(this.$btn.attr("name")!=undefined){this.$valueBox.attr("name",this.$btn.attr("name"));this.$btn.removeAttr("name")}};IconBox.prototype.openIconWrap=function(){var b=this,a=b.options;$.dopen({title:"请选择",content:'<div class="open_iconWrap"></div>',area:["580px","400px"],btn:["确定","取消"],btn1:function(d){b.appendShowIcon(b.getData());b.onTrigger();layer.close(d)},success:function(d,e){b.$openWrap=d.find(".open_iconWrap");c()}});function c(){var e='<ul class="list-unstyled clearfix">';$.each(b.datas,function(f){var g=b.datas[f];e+='<li class="icon_item pull-left text-center" data-id="'+g[a.idKey]+'">';if(g[a.iconKey]&&g[a.iconKey]!==""){e+='<img src="'+g[a.iconKey]+'" />'}else{e+='<i class="min-icon '+g[a.classKey]+'"></i>'}e+="</li>"});e+="</ul>";b.$openWrap.append(e).find(".icon_item").on("click",function(){if($(this).hasClass("active")){$(this).removeClass("active")}else{$(this).addClass("active")}if(!a.multiple){$(this).siblings().removeClass("active")}});var d=b.getValue();if(d!==""){b.setActive(d.split(","))}}};IconBox.prototype.appendShowIcon=function(a){var d=this,c=d.options,b="";d.$showIcon.empty();$.each(a,function(){var e=this;b+=e[c.idKey]+",";if(e[c.iconKey]&&e[c.iconKey]!==""){d.$showIcon.append('<img src="'+e[c.iconKey]+'" />')}else{d.$showIcon.append('<i class="min-icon '+e[c.classKey]+'"></i>')}});d.$valueBox.val(b.substr(0,b.length-1))};IconBox.prototype.setValue=function(c){this.clear();if(!c||c===""){return}var b=this,a=c.split(","),d=[];b.$valueBox.val(c);$.each(a,function(f){var e=b.getDataById(a[f]);if(e!=null){d.push(e)}});b.appendShowIcon(d)};IconBox.prototype.setActive=function(a){var b=this;$.each(a,function(c){b.$openWrap.find("li[data-id='"+a[c]+"']").addClass("active")})};IconBox.prototype.getValue=function(){return this.$valueBox.val()};IconBox.prototype.getData=function(){var c=this,b=c.options,e=c.$openWrap,d=e.find(".icon_item.active"),a=[];d.each(function(){var f=$(this).data("id");$.each(c.datas,function(){if(f==this[b.idKey]){a.push(this)}})});return a};IconBox.prototype.getDataById=function(e){var d=this,c=d.options,b=d.datas,a=null;$.each(b,function(){if(e==this[c.idKey]){a=this;return false}});return a};IconBox.prototype.clear=function(){this.$valueBox.val("");this.$showIcon.empty()};IconBox.prototype.destroy=function(){this.$outerBox.remove()};IconBox.prototype.disable=function(){this.$btn.attr("disabled","disabled")};IconBox.prototype.enable=function(){this.$btn.removeAttr("disabled")};IconBox.prototype.setDisabled=function(a){if(a==true){this.disable();this.$valueBox.attr("disabled","disabled")}else{this.enable();this.$valueBox.removeAttr("disabled")}};IconBox.prototype.setReadonly=function(a){if(a==true){this.disable()}else{this.enable()}};IconBox.prototype.onTrigger=function(){var b=this;b.$outerBox.removeClass("has-error");if(b.options.required||b.options.validate){var a=b.validate();if(!a){b.options.validFail.apply(this,[b.$btn])}else{b.options.validSuccess.apply(this,[b.$btn])}}};IconBox.prototype.validate=function(){var b=true,g=$.trim(this.$valueBox.val()),f=this,c=this.options,e=this.$btn;if(f.$btn.is(":disabled")){return b}if(c.required&&g==""){this.tips("该选项为必填",this.$outerBox);this.$outerBox.addClass("has-error");return false}if(typeof c.validate=="function"){var h=c.validate.apply(c,[f.$valueBox.val(),g]);if(h&&h.result==false){this.tips(h.msg,f.$outerBox);this.$outerBox.addClass("has-error");return h.result}}else{if(typeof c.validate=="string"){var d=c.validate.split("|"),a;$.each(d,function(j,k){b=$.globalValid[k].reg.test(g);a=$.globalValid[k].text;if(!b){return false}});if(!b){f.tips(a,f.$outerBox)}}}if(b){this.$outerBox.removeClass("has-error")}else{this.$outerBox.addClass("has-error")}return b};IconBox.prototype.tips=function(b,a){layer.tips(b,a,{tipsMore:true,time:2000})};