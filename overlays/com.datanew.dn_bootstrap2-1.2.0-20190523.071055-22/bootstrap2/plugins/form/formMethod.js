var formMthod={defaultVal:{},initForm:function(f,h){formMthod.defaultVal={};var B={};function j(H){var i=false;for(var I in B){if(B[I]==false&&I!=H){i=false;break}else{B[H]=true;i=true}}if(i&&h.onLoadedCallBack!=undefined){h.onLoadedCallBack()}}function e(i){if(i.url!=null||i.dataUrl!=null){B[i.name]=false;i.formInitCallBack=j}}function C(){var i=setTimeout(function(){f.find(".uploader").each(function(H){var I=$(this);if(!I.parent().hasClass(".dform-input")){I.parent().addClass("flex_val_1").parent().css({height:"auto"})}})},10)}var s={rownum:3,labelwidth:"50px",showtitle:"left",plugSize:"xs",labelAlign:"left"};h=$.extend({},s,h);f.addClass("form-inline clearfix");if(h.formVertical){f.addClass("form-vertical")}if(h.id!==undefined){f.attr("id",h.id)}var a="";if(h.plugSize==="xs"){f.addClass("form-xs");a="20px"}else{f.addClass("form-sm");a="30px"}f.html("");if(h.inputs){var D=Math.floor(12/h.rownum);var b={id:null,colspan:1,rowspan:1,defaultValue:"",disabled:false,setDisabled:false,setReadonly:false};for(var w=0;w<h.inputs.length;w++){var y=false;var o=h.inputs[w],t=o.id==null?"":' id="'+o.id+'" ',A=o.required?"requiredMark":"";o=$.extend({},b,o);formMthod.defaultVal[o.name]=o.defaultValue;var c=parseInt(a)*parseInt(o.rowspan)+(o.rowspan-1)*6,z=o.rowspan>1?"height:"+c+"px":"";var n="<div class='dform-input form-group dis_flex col-sm-"+D*o.colspan+"' style='"+z+"'>";if(o.type!=null&&h.showtitle=="left"){n+="<label class='control-label "+A+" label-align-"+h.labelAlign+"' for='' style='width:"+h.labelwidth+" ;line-height:"+a+"'>"+o.title+"</label>"}var g=o.proving==null?"":"proving='"+o.proving+"'";var u=o.dname==null?o.name:o.dname;if(o.type==null){n+="</div>";f.append(n)}else{if(o.type=="select"||o.type=="dselect"){n+="<select "+t+' class="form-control flex_val_1"  '+(o.disabled?"disabled":"")+(o.setDisabled?" disabled ":"")+(o.setReadonly?" readonly ":"")+g+' dname="'+u+'"  name="'+o.name+'"></select></div>';f.append(n);f.find(".form-group select:last").dselect(o);f.find(".form-group select:last").parent().addClass("flex_val_1")}else{if(o.type=="ddate"){n+="<input "+t+' type="text"  '+(o.disabled?"disabled":"")+(o.setDisabled?" disabled ":"")+(o.setReadonly?" readonly ":"")+" "+g+' dname="'+u+'" name="'+o.name+'" class="form-control bgwhite" /></div>';f.append(n);f.find(".form-group input:last").ddate(o);var G=f.width()/(h.rownum*o.colspan)-30;var E=G-parseInt(h.labelwidth);f.find(".form-group input:last").parent().addClass("flex_val_1").width(E)}else{if(o.type=="dsearchtree"||o.type=="searchTree"){n+="<input "+t+' type="text" '+(o.disabled?"disabled":"")+(o.setDisabled?" disabled ":"")+(o.setReadonly?" readonly ":"")+" "+g+' dname="'+u+'" name="'+o.name+'" class="form-control" style="width:100%;" /></div>';f.append(n);e(o);if(o.isGetText){f.find(".form-group input:last").data({isGetText:o.isGetText,getTextField:o.getTextField})}f.find(".form-group input:last").searchTree(o);f.find(".form-group input:last").parent().addClass("flex_val_1");f.find(".form-group:last-child .valueBox").data("async",($.plugAsyncConfig||false)&&!!o.url);var F=f.find(".form-group:last-child").find(".form-control");x(F,o)}else{if(o.type=="ddecimal"||o.type=="decimal"){n+="<input "+t+' type="number" '+(o.disabled?"disabled":"")+(o.setDisabled?" disabled ":"")+(o.setReadonly?" readonly ":"")+" "+g+' dname="'+u+'" name="'+o.name+'" class="form-control" style="width:100%;" /></div>';f.append(n);f.find(".form-group input:last").decimal(o);f.find(".form-group input:last").parent().addClass("flex_val_1");var F=f.find(".form-group:last-child").find(".form-control");x(F,o)}else{if(o.type=="html"){n+="<span class='ztreeBox_inp ztreeBox_down flex_val_1'>"+o.html+"</span>";n+="</div>";f.append(n)}else{if(o.type=="hidden"){n+="<input "+t+" "+g+' dname="'+u+'"  name="'+o.name+'" type="'+o.type+'" '+(o.disabled?"disabled":"")+(o.setDisabled?" disabled ":"")+(o.setReadonly?" readonly ":"")+' class="form-control flex_val_1" '+(o.placeholder==true?('  placeholder="请输入'+o.title):"")+'" value="'+o.defaultValue+'"></div>';f.append(n);f.find(".dform-input:last").hide();var F=f.find(".form-group:last-child").find(".form-control");x(F,o)}else{if(o.type=="comboTree"){n+="<input "+t+" "+g+' dname="'+u+'"  name="'+o.name+'" type="'+o.type+'" '+(o.disabled?"disabled":"")+(o.setDisabled?" disabled ":"")+(o.setReadonly?" readonly ":"")+' class="form-control " '+(o.placeholder==true?('  placeholder="请输入'+o.title):"")+'"></div>';f.append(n);e(o);if(o.isGetText){f.find(".form-group input:last").data({isGetText:o.isGetText,getTextField:o.getTextField})}f.find(".form-group input:last").comboTree(o);f.find(".form-group input:last").parent().addClass("flex_val_1");f.find(".form-group:last-child .valueBox").data("async",($.plugAsyncConfig||false)&&!!o.url);var F=f.find(".form-group:last-child").find(".form-control");x(F,o)}else{if(o.type=="textBox"||o.type=="text"){var r=o.isPassword?"password":o.type;n+="<input "+t+" "+g+' dname="'+u+'"  name="'+o.name+'" type="'+r+'" '+(o.disabled?"disabled":"")+(o.setDisabled?" disabled ":"")+(o.setReadonly?" readonly ":"")+' class="form-control " style="width:100%;" ></div>';f.append(n);if(o.multiline){f.find(".form-group input:last").parent().height("auto")}f.find(".form-group input:last").textBox(o);f.find(".form-group input:last").parent().addClass("flex_val_1");var F=f.find(".form-group:last-child").find(".form-control");x(F,o)}else{if(o.type=="comboBox"){n+="<input "+t+"  "+g+' dname="'+u+'"  name="'+o.name+'" type="'+o.type+'" '+(o.disabled?"disabled":"")+(o.setDisabled?" disabled ":"")+(o.setReadonly?" readonly ":"")+' class="form-control " '+(o.placeholder==true?('  placeholder="请输入'+o.title):"")+'"></div>';f.append(n);e(o);if(o.isGetText){f.find(".form-group input:last").data({isGetText:o.isGetText,getTextField:o.getTextField})}f.find(".form-group input:last").comboBox(o);f.find(".form-group input:last").parent().addClass("flex_val_1");var F=f.find(".form-group:last-child").find(".form-control");x(F,o)}else{if(o.type=="dateBox"){n+="<input "+t+"  "+g+' dname="'+u+'"  name="'+o.name+'" type="'+o.type+'" '+(o.disabled?"disabled":"")+(o.setDisabled?" disabled ":"")+(o.setReadonly?" readonly ":"")+' class="form-control"'+(o.placeholder==true?('  placeholder="请输入'+o.title):"")+'"></div>';f.append(n);f.find(".form-group input:last").dateBox(o);f.find(".form-group input:last").parent().css({width:"100%"}).wrap('<div class="flex_val_1"></div>');var F=f.find(".form-group:last-child").find(".form-control");x(F,o)}else{if(o.type=="checkbox"){if(!o.options){return}$.each(o.options,function(H,I){n+='<lable style="margin-left: 8px;line-height: 30px;">'+I.lable+"</lable>";n+='<input  name="'+o.name+'" type="checkbox" value="'+I.value+'" style="vertical-align: middle;margin-top: 8px;">'});n+="</div>";f.append(n)}else{if(o.type=="webupload"){n+="</div>";var m=$("<div "+t+"></div>");f.append(n).find(".form-group:last").append(m);e(o);m.webupload(o);C(o)}else{if(o.type=="textEditor"){n+='<textarea class="textEditor" '+t+' name="'+o.name+'" dname="'+u+'" type="'+o.type+'" boxtype="'+o.type+'"></textarea></div>';f.append(n);f.find(".form-group .textEditor:last").textEditor(o);f.find(".form-group .textEditor:last").parent().addClass("flex_val_1").parent().css({height:"auto"})}else{if(o.type=="plainText"){n+='<div class="flex_val_1 text-'+(o.textAlign==undefined?"center":o.textAlign)+'" '+t+' style="min-height:'+a+";line-height:"+a+";"+(o.styles?o.styles:"")+'">'+(o.plainText==undefined?"":o.plainText)+"</div></div>";f.append(n);f.find(".form-group:last").find(".control-label").remove()}else{if(o.type=="title"){n+="";f.append(n)}else{if(o.type=="billPrint"){n+="<div "+t+' name="'+o.name+'" dname="'+o.name+'" type="'+o.type+'" boxtype="'+o.type+'" class="printWrap"></div>';f.append(n);var k=f.find(".form-group .printWrap:last");var q=o.addNodeOpts,v=$('<button type="button" class="btn btn-primary btn-xs" style="position:absolute; left:8px; top:40px;">新增节点</button>').insertAfter(k);k.billPrint(o);k.wrap('<div class="flex_val_1"></div>').parent().parent().css({height:"auto"});v.on("click",function(){k.billPrint("addTxtNode",q)})}else{if(o.type=="mediaBox"){n+="<a "+t+' type="'+o.type+'" class="mediaBox"></div>';f.append(n);o.width="100%";f.find(".form-group .mediaBox:last").mediaBox(o);f.find(".form-group .mediaBox:last").wrap('<div class="flex_val_1"></div>').parent().parent().css({height:"auto"})}else{if(o.type=="videoBox"){n+="<div "+t+' type="'+o.type+'" class="videoBox"></div>';f.append(n);o.width="100%";f.find(".form-group .videoBox:last").videoBox(o);f.find(".form-group .videoBox:last").wrap('<div class="flex_val_1"></div>').parent().parent().css({height:"auto"})}else{if(o.type=="iconBox"){n+="<button "+t+" "+g+' dname="'+u+'" name="'+o.name+'" type="'+o.type+'" '+(o.disabled?"disabled":"")+(o.setDisabled?" disabled ":"")+(o.setReadonly?" readonly ":"")+' class="iconBtn"></button>';f.append(n);f.find(".form-group .iconBtn:last").iconBox(o);f.find(".form-group .iconBtn:last").parent().addClass("flex_val_1")}else{if(o.type=="radioBox"){n+="<div "+t+" "+g+' dname="'+u+'" name="'+o.name+'" type="'+o.type+'" '+(o.disabled?"disabled":"")+(o.setDisabled?" disabled ":"")+(o.setReadonly?" readonly ":"")+' class="radioBox"></div>';f.append(n);f.find(".form-group .radioBox:last").radioBox(o);f.find(".form-group .radioBox:last").addClass("flex_val_1")}else{n+="<input "+t+"  "+g+' dname="'+u+'"  name="'+o.name+'" type="'+o.type+'" '+(o.disabled?"disabled":"")+(o.setDisabled?" disabled ":"")+(o.setReadonly?" readonly ":"")+' class="form-control flex_val_1" '+(o.placeholder==true?('  placeholder="请输入'+o.title):"")+'" value="'+o.defaultValue+'"></div>';f.append(n)}}}}}}}}}}}}}}}}}}}}}if(o.url||o.dataUrl){y=true}if(h.formVertical&&o.hoverTips){var l=f.find(".form-group:last"),d=l.find(".glyphicon-question-sign"),p=d.clone().appendTo(l.find(".control-label"));d.remove();p.tooltip()}}f.data("defaultVal",JSON.stringify(formMthod.defaultVal))}if(h.formtitle&&h.formtitle!=""){f.wrapInner("<fieldset class='form-fieldset'></fieldset>");f.find("fieldset").prepend("<legend class='form-legend'>"+h.formtitle+"</legend>")}if(h.onLoadedCallBack){}function x(i,I){var H=i.siblings(".valueBox").attr("boxtype");if(I.setDisabled){i[H]("setDisabled",true)}if(I.setReadonly){i.removeClass("bgwhite").addClass("readonly");i[H]("disable")}}},upload:function(a){$(this).ajaxSubmit(a)},submit:function(d){var a=formMthod.validate.apply(this);if(!a){return}var c=formMthod.getData.apply(this);if(d.data){var b=d.data;d.data=$.extend({},b,c)}else{d.data=c}$.dajax(d)},getInputObj:function(c,d){var e="name";if(d!=null){e=d}var b,a=c.attr("boxType");if(c.attr(e)!==undefined&&c.attr("boxType")!==undefined){if(a==="webupload"||a==="radioBox"){b=c.parent()}else{if(a==="textEditor"||a==="billPrint"){b=c}else{if(a==="iconBox"){b=c.parent().find(".iconBtn")}else{b=c.parent().find(".form-control")}}}}return b},getData:function(){var a=this.serializeArray(),f={};$.each(a,function(){if(f[this.name]!=undefined){if(!f[this.name].push){f[this.name]=[f[this.name]]}f[this.name].push(this.value||"")}else{f[this.name]=this.value||""}});var b=$(this).find("[boxType='textEditor']");if(b.length>0&&!b.prop("disabled")){f[b.attr("name")]=d(b.textEditor("getValue"))}var e=$(this).find("[boxType='billPrint']");if(e.length>0&&!e.prop("disabled")){f[e.attr("name")]=d(e.billPrint("getValue"))}var c=$(this).find("[boxType='searchTree'], [boxType='comboTree'], [boxType='comboBox']");c.each(function(){var i=$(this).attr("boxType"),g=$(this).attr("name"),j=$(this).siblings(".form-control");if(j.data("isGetText")){var h=j.data("getTextField")?j.data("getTextField"):g+"_text",k=j[i]("getText");f[h]=k}});function d(g){g=g.replace(/&/g,"&amp;");g=g.replace(/</g,"&lt;");g=g.replace(/>/g,"&gt;");g=g.replace(/'/g,"&acute;");g=g.replace(/"/g,"&quot;");g=g.replace(/\|/g,"&brvbar;");g=g.replace(/\n/g,"");g=g.replace(/\t/g,"");return g}return f},getValueByName:function(a){var b=this.dform("getData");for(var c in b){if(c===a){return b[c]}}},setValueByName:function(d,e){if($("[name="+d+"]",$(this)).hasClass("form-control")){$("[name="+d+"]",$(this)).val(e);return false}var c=$("[name="+d+"][boxType]",$(this)),b=c.attr("boxType"),a;if(c.data("async")==false&&c.data("async")!==undefined){a=formMthod.getInputObj(c);if(a){a[b]("setValue",e)}}else{c.val(e)}},executeByName:function(e,g,f){var d=$("[name="+e+"][boxType]",$(this)),c=d.attr("boxType"),b=formMthod.getInputObj(d);if(b){var a=b[c](g,f);if(a!==undefined){return a}}},load:function(c,a){var b="name";if(a!=null){b=a}$(this).find("["+b+"][boxType]").each(function(){var f=$(this),g=f.attr(b),e=f.attr("boxType"),d;if($(this).data("async")==false&&$(this).data("async")!==undefined){d=formMthod.getInputObj(f,a);if(d){d[e]("setValue",c[g])}}if(c[g]!=null){f.val(c[g])}else{f.val("")}});formMthod.executeInputMethod.apply(this,["setValue",c,a])},validate:function(){var a=true;$("[proving]",this).each(function(){if(!$.dvalidate($(this),true)){a=false;$(this).change()}});$("[name][boxType]",$(this)).each(function(){var d=$(this),c=d.attr("boxType"),b=formMthod.getInputObj(d);if(b&&!b[c]("validate")){a=false;return false}});return a},clear:function(){$(this).clearForm(true);formMthod.executeInputMethod.apply(this,["clear"]);$(this).find(".has-error").each(function(a,b){b.classList.remove("has-error")})},initDefault:function(){$(this).dform("load",JSON.parse($(this).data("defaultVal")))},readonly:function(){$(":input",this).each(function(){$(this).attr("readonly",true)});formMthod.executeInputMethod.apply(this,["readonly"])},disabled:function(){$(":input",this).each(function(){$(this).attr("readonly",true)});$("select",this).each(function(){$(this).attr("disabled",true)});formMthod.executeInputMethod.apply(this,["disable"])},enable:function(){$(":input",this).each(function(){var a=$(this).siblings(".valueBox").attr("boxtype");if(a!="dateBox"&&a!="searchTree"&&a!="comboBox"&&a!="comboTree"){$(this).removeAttr("readonly")}});$("select",this).each(function(){$(this).attr("disabled",false)});formMthod.executeInputMethod.apply(this,["enable"])},setDisabled:function(a){if(a==true){$(".dform-input > input:hidden").attr({readonly:true,disabled:true});$("textarea[boxtype]",this).attr({readonly:true,disabled:true});formMthod.disabled()}else{$(".dform-input > input:hidden").removeAttr("readonly").removeAttr("disabled");$("textarea[boxtype]",this).removeAttr("readonly").removeAttr("disabled");formMthod.enable()}formMthod.executeInputMethod.apply(this,["setDisabled",a])},setReadonly:function(a){if(a==true){formMthod.disabled()}else{formMthod.enable()}formMthod.executeInputMethod.apply(this,["setReadonly",a])},destroy:function(){$(this).find("[name][boxType]").each(function(){var c=$(this),b=c.attr("boxType"),a=formMthod.getInputObj(c);if(a){a[b]("destroy")}c.remove()})},executeInputMethod:function(d,c,a){var b="name";if(a!=null){b=a}$("["+b+"][boxType]",$(this)).each(function(){var g=$(this),f=g.attr("boxType"),e=formMthod.getInputObj(g,a);if(e){e[f](d,d=="setValue"?c[$(this).attr(b)]:c)}})}};